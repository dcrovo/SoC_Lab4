#include "system.h"
#include <stdio.h>
#include "gpio.h"


typedef struct flash_cmd{
	int pause;
	int prd;
} cmd_type;

int main()
{

	cmd_type sw_cmd={0,100}; //initial value: not pause, 100 ms interval
	flashsys_init_v1(BTN_BASE, USR_TIMER_BASE);

	while(1){
		sw_get_command_v1(BTN_BASE, SWITCH_BASE, &sw_cmd);
		//jtaguart_disp_msg_v1(JTAG_UART_BASE, sw_cmd);
		//sseg_disp_msg_v1(SSEG_BASE, sw_cmd);
		//led_flash_v1(LEDF_BASE, USR_TIMER_BASE, sw_cmd);
	}
  return 0;
}


void flashsys_init_v1(alt_u32 btn_base, alt_u32 timer_base){
	btn_clear(btn_base); // clear button edge-capture reg
	timer_wr_prd(timer_base, 50000); // set 1-ms timeout period
}

void sw_get_command_v1(alt_u32 btn_base, alt_32 sw_base, cmd_type *cmd){
	alt_u8 btn;
	btn = (alt_u8) btn_read(btn_base) & 0xF; //read 4 pushbuttons
	if(btn != 0){ // button pressed
		if(btn & 0x01){ // btn 0 pressed
			cmd->pause = cmd->pause ^ 1; // toogle pause bit
		}
		if (btn & 0x02){
			cmd->prd = pio_read(sw_base) & 0x03FF; // load new interval
			btn_clear(btn_base); //clear edge-capture reg
		}
	}
}
